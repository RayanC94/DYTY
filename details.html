<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dyty Automobile ‚Äî D√©tail v√©hicule</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <div class="container header-inner">
      <a class="logo" href="index.html#accueil">Dyty Automobile</a>
      <nav class="nav">
        <a href="index.html#stock">V√©hicules</a>
        <a href="index.html#contact" class="btn-gold">Contact</a>
      </nav>
    </div>
  </header>

  <main class="container detail" id="detailRoot">
    <p>Chargement du v√©hicule...</p>
  </main>

  <footer class="footer">
    <div class="container">
      <p class="copyright">¬© 2025 Dyty Automobile ‚Äî Tous droits r√©serv√©s.</p>
    </div>
  </footer>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const supabaseUrl = 'https://vosmwhlwkbwkczmwmitx.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvc213aGx3a2J3a2N6bXdtaXR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNjk4MTMsImV4cCI6MjA3Nzk0NTgxM30.fyvgpiYuZHBpsT6X1Zfs1Z_ALxIndnBFW8N5QcU5yo8';
    const supabase = createClient(supabaseUrl, supabaseKey);

    function getIdFromUrl () {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    async function loadCar () {
      const root = document.getElementById('detailRoot');
      const id = getIdFromUrl();

      if (!id) {
        root.innerHTML = '<p>V√©hicule introuvable.</p>';
        return;
      }

      const { data, error } = await supabase
        .from('voitures')
        .select('*')
        .eq('id', id)
        .single();

      if (error || !data) {
        console.error(error);
        root.innerHTML = '<p>V√©hicule introuvable.</p>';
        return;
      }

      const v = data;

      document.title = `${v.marque} ${v.modele} ‚Äî Dyty Automobile`;

      root.innerHTML = `
  <div class="detail-grid">
    <div class="detail-media">
      ${v.vendu ? '<div class="badge-vendu">Vendu</div>' : ''}
      <img src="${v.image_url ? v.image_url : 'placeholder.jpg'}"
           alt="Photo de ${v.marque} ${v.modele}">
    </div>

    <div class="detail-info ${v.vendu ? 'car-sold' : ''}">
      <h1>${v.marque} ${v.modele}</h1>
      <p class="muted">
        ${v.annee} ‚Ä¢
        ${Number(v.kilometrage).toLocaleString('fr-FR')} km ‚Ä¢
        ${v.carburant}
      </p>
      ${
        v.motorisation || v.chevaux
          ? `<p class="muted">
              ${v.motorisation ? `${v.motorisation}` : ''}
              ${v.motorisation && v.chevaux ? ' ‚Ä¢ ' : ''}
              ${v.chevaux ? `${v.chevaux} ch` : ''}
            </p>`
          : ''
      }
      <div class="price xl">
        ${Number(v.prix).toLocaleString('fr-FR')} ‚Ç¨
      </div>

      <dl class="specs">
        <div><dt>Bo√Æte</dt><dd>${v.boite}</dd></div>
        <div><dt>Carburant</dt><dd>${v.carburant}</dd></div>
        ${v.motorisation ? `<div><dt>Motorisation</dt><dd>${v.motorisation}</dd></div>` : ''}
        ${v.chevaux ? `<div><dt>Puissance</dt><dd>${v.chevaux} ch</dd></div>` : ''}
        <div><dt>Couleur</dt><dd>${v.couleur ?? ''}</dd></div>
      </dl>

      ${v.description_courte ? `
        <h2>En r√©sum√©</h2>
        <p>${v.description_courte.replace(/\n/g, '<br>')}</p>
      ` : ''}

      ${v.options ? `
        <h2>√âquipements & options</h2>
        <p>${v.options.replace(/\n/g, '<br>')}</p>
      ` : ''}

      <div class="actions">
        ${
          v.vendu
            ? '<p style="color:#b30000;font-weight:600;">Ce v√©hicule est d√©j√† vendu üíî</p>'
            : `
              <a href="index.html#contact" class="btn-gold">R√©server un essai</a>
              <a href="index.html#contact" class="btn-outline">Demander le dossier</a>
            `
        }
      </div>
    </div>
  </div>
`;

    }

    loadCar();
  </script>
</body>
</html>
