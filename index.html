<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dyty Automobile — Véhicules d’occasion</title>
  <meta name="description" content="Vente de voitures d’occasion sélectionnées. Découvrez le stock de Dyty Automobile et contactez-nous." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container header-inner">
      <a class="logo" href="#accueil">Dyty Automobile</a>
      <nav class="nav">
        <a href="#stock">Véhicules</a>
        <a href="#contact" class="btn-gold">Contact</a>
      </nav>
    </div>
  </header>

  <!-- HERO simple et doré -->
  <section id="accueil" class="hero">
    <div class="container hero-content">
      <h1 class="hero-title">Dyty Automobile</h1>
      <p class="hero-subtitle">Votre confiance, notre moteur.</p>
    </div>
  </section>

  <!-- STOCK -->
  <section id="stock" class="stock">
    <div class="container">
      <h2>Nos véhicules disponibles</h2>

      <div id="vehicleGrid" class="vehicle-grid">
        <!-- Les cartes voitures seront injectées ici -->
      </div>

      <p id="noCarsMsg" style="margin-top:20px; display:none;">
        Aucun véhicule disponible pour le moment.
      </p>
    </div>
  </section>

  <!-- CONTACT -->
  <footer id="contact" class="footer">
    <div class="container contact-wrapper">
      <div class="contact-info">
        <h2>Contact</h2>
        <p>
          Besoin d’un renseignement&nbsp;? Nous sommes à votre écoute par téléphone ou par email.
        </p>
        <ul>
          <li><strong>Tél :</strong> <a href="tel:+33123456789">01&nbsp;23&nbsp;45&nbsp;67&nbsp;89</a></li>
          <li><strong>Email :</strong> <a href="mailto:contact@dyty-auto.fr">contact@dyty-auto.fr</a></li>
        </ul>
      </div>

      <form class="contact-form" action="mailto:contact@dyty-auto.fr" method="post" enctype="text/plain">
        <h3>Être recontacté</h3>
        <div class="contact-form-row">
          <label for="contact-lastname">Nom</label>
          <input id="contact-lastname" name="Nom" type="text" placeholder="Dupont" required>
        </div>
        <div class="contact-form-row">
          <label for="contact-firstname">Prénom</label>
          <input id="contact-firstname" name="Prénom" type="text" placeholder="Jean" required>
        </div>
        <div class="contact-form-row">
          <label for="contact-email">Email</label>
          <input id="contact-email" name="Email" type="email" placeholder="jean.dupont@email.fr" required>
        </div>
        <div class="contact-form-row">
          <label for="contact-phone">Téléphone</label>
          <input id="contact-phone" name="Téléphone" type="tel" placeholder="06 12 34 56 78" required>
        </div>
        <div class="contact-form-row">
          <label for="contact-time">Horaire souhaité</label>
          <input id="contact-time" name="Horaire souhaité" type="text" placeholder="Ex. : Lundi 14h-16h" required>
        </div>
        <button class="btn-gold" type="submit">Envoyer ma demande</button>
      </form>
    </div>
    <div class="container">
      <p class="copyright">© 2025 Dyty Automobile — Tous droits réservés.</p>
    </div>
  </footer>

  <!-- Supabase + script -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const supabaseUrl = 'https://vosmwhlwkbwkczmwmitx.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvc213aGx3a2J3a2N6bXdtaXR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNjk4MTMsImV4cCI6MjA3Nzk0NTgxM30.fyvgpiYuZHBpsT6X1Zfs1Z_ALxIndnBFW8N5QcU5yo8';
    const supabase = createClient(supabaseUrl, supabaseKey);
   
    async function loadCars () {
      const grid = document.getElementById('vehicleGrid');
      const emptyMsg = document.getElementById('noCarsMsg');

      const { data, error } = await supabase
        .from('voitures')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) {
        console.error(error);
        grid.innerHTML = '<p>Erreur lors du chargement des véhicules.</p>';
        return;
      }

      if (!data || data.length === 0) {
        emptyMsg.style.display = 'block';
        return;
      }

      grid.innerHTML = '';
      for (const v of data) {
        const card = document.createElement('article');
        card.className = 'car-card';

        const href = `details.html?id=${encodeURIComponent(v.id)}`;

        card.innerHTML = `
      <a class="card-link" href="${href}">
        ${v.vendu ? '<div class="badge-vendu">Vendu</div>' : ''}
        <img src="${v.image_url ? v.image_url : 'placeholder.jpg'}"
            alt="Photo de ${v.marque} ${v.modele}">
        <div class="car-body ${v.vendu ? 'car-sold' : ''}">
          <h3>${v.marque} ${v.modele}</h3>
          <p>
            ${v.annee} •
            ${Number(v.kilometrage).toLocaleString('fr-FR')} km •
            ${v.carburant}
          </p>
          ${(v.motorisation || v.chevaux) ? `
            <p class="muted">
              ${v.motorisation ? `${v.motorisation}` : ''}
              ${v.motorisation && v.chevaux ? ' • ' : ''}
              ${v.chevaux ? `${v.chevaux} ch` : ''}
            </p>
          ` : ''}
          <div class="price">
            ${Number(v.prix).toLocaleString('fr-FR')} €
          </div>
        </div>
      </a>
    `;

        grid.appendChild(card);
      }
    }

    loadCars();
  </script>
</body>
</html>
